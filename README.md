
# Проверка шахматного движка на C#

## Запуск проекта

В корне репозитория:
```sh
dotnet restore
dotnet test
```

## Выбор фигур для тестирования

Для демонстрации различных аспектов шахматной логики выбрали **Пешку** и **Ладью**:

* **Пешка** — усложнённые правила хода, специальные ситуации (взятие на проходе, превращение)
* **Ладья** — прямолинейные ходы, но с жёсткой проверкой наличия преград на пути

## Структура решения

### Основные интерфейсы и классы:

1. **IChessman** — общий интерфейс для всех фигур
2. **ChessField** — модель одной клетки шахматной доски
3. **ChessMove** — представление хода с шахматной нотацией
4. **ChessBoard** — доска и игровая логика
5. **Chessman** — базовый абстрактный класс для фигур
6. **Pawn** — реализация пешки
7. **Rook** — реализация ладьи

### Перечисления:

* **EChessmanType** — перечень типов шахматных фигур
* **ESide** — цвет (белые/чёрные)

## Логика тестирования

### 1. Тесты для пешки (Pawn)

#### Позитивные сценарии:

* **Pawn\_OneStepForward\_ShouldBeValid**: проверяется корректный ход пешки на одно поле вперёд
* **Pawn\_TwoStepsFromStart\_ShouldBeValid**: проверка двойного хода из начальной позиции
* **Pawn\_DiagonalCapture\_ShouldBeValid**: тест взятия по диагонали
* **Pawn\_EnPassantCapture\_ShouldBeValid**: проверка правила взятия на проходе
* **Pawn\_PromotionToQueen\_ShouldBeValid**: тест превращения пешки при достижении последней горизонтали

#### Негативные сценарии:

* **Pawn\_TwoStepsAfterMoving\_ShouldThrowException**: нельзя сделать двойной ход после первого хода
* **Pawn\_DiagonalMoveWithoutCapture\_ShouldThrowException**: запрет ходить по диагонали без взятия
* **Pawn\_ForwardMoveBlocked\_ShouldThrowException**: нельзя ходить вперёд, если путь заблокирован
* **Pawn\_BackwardMove\_ShouldThrowException**: пешка не может двигаться назад

### 2. Тесты для ладьи (Rook)

#### Позитивные сценарии:

* **Rook\_HorizontalMove\_ShouldBeValid**: проверка горизонтального перемещения ладьи
* **Rook\_VerticalMove\_ShouldBeValid**: проверка вертикального хода ладьи
* **Rook\_CaptureEnemyPiece\_ShouldBeValid**: тест взятия чужой фигуры
* **Rook\_LongVerticalMove\_ShouldBeValid**: проверка длинного вертикального хода

#### Негативные сценарии:

* **Rook\_DiagonalMove\_ShouldThrowException**: ладья не может ходить по диагонали
* **Rook\_MoveBlockedByOwnPiece\_ShouldThrowException**: нельзя перепрыгивать свои фигуры
* **Rook\_MoveBlockedByEnemyPiece\_ShouldThrowException**: нельзя перепрыгивать чужие фигуры
* **Rook\_CaptureOwnPiece\_ShouldThrowException**: нельзя взять свою фигуру

### 3. Тесты формирования нотации хода (ChessMove)

* **ChessMove\_SimpleMove\_ShouldReturnCorrectNotation**: проверка базовой нотации для простого хода
* **ChessMove\_CaptureMove\_ShouldReturnCorrectNotation**: тест нотации хода со взятием
* **ChessMove\_PawnPromotion\_ShouldReturnCorrectNotation**: проверка нотации при превращении пешки

### 4. Тесты валидации поля (ChessField)

* **ChessField\_InvalidRow\_ShouldThrowException**: проверка некорректного значения строки (row)
* **ChessField\_InvalidColumn\_ShouldThrowException**: проверка некорректного значения столбца (column)
* **ChessField\_ValidCoordinates\_ShouldNotThrow**: проверка корректных координат без ошибок

## Особенности реализации

### 1. Подход TDD (разработка через тестирование):

1. Сначала создавались тесты для каждого сценария
2. Затем писался минимальный код, чтобы пройти эти тесты
3. Наконец, код рефакторился для улучшения архитектуры

### 2. Обработка сложных шахматных правил:

* **Взятие на проходе (en passant)**: реализована полная логика с учётом последнего хода
* **Превращение пешки**: автоматическое превращение в ферзя при попадании на восьмую горизонталь
* **Проверка свободного пути (для ладьи)**: реализована проверка отсутствия фигур между начальной и конечной клетками

### 3. Генерация шахматной нотации:

Метод `AsString()` класса `ChessMove` формирует корректную запись хода:

* Простой ход: `"e4"`, `"Ra8"`
* Взятие: `"exd5"`, `"Rxh1"`
* Специальные ходы: `"e8=Q"` (превращение), `"exd6 e.p."` (взятие на проходе)

## Результаты тестирования

### Итоги:

✅ Все 17 тестов для пешки выполнены успешно  
✅ Все 8 тестов для ладьи выполнены успешно  
✅ Все 3 теста для нотации хода пройдены успешно  
✅ Все 3 теста валидации поля выполнены успешно
